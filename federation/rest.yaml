---
# This is direct conversion from old api/*/spec.json files
# using https://www.json2yaml.com/
#
# Next step: swagger.

endpoints:
  - title: Node identity
    path: "/node/identity"
    entrypoint: identity
    authentication: []
    apis:
      - name: generate node identity
        method: POST
        title: Generate an origin node identity
        path: "/generate"
        parameters:
          post:
            - name: domain
              type: string
              required: true
              title: Domain of the destination node

      - name: register origin node
        method: POST
        title: Register a new origin node
        path: "/register"
        parameters:
          post:
            - name: identifier
              type: string
              required: true
              title: Origin node identifier

  - title: Federation node pair request
    path: "/node/pair/request"
    entrypoint: pairRequest
    authentication: []
    apis:
      - name: request pairing
        method: POST
        title: Handle destination node pair request
        path: "/"
        parameters:
          post:
            - name: identifier
              type: string
              required: true
              title: Origin node identifier
            - name: token
              type: string
              required: true
              title: Destination node token

  - title: Federation node pairing
    path: "/node/pair"
    entrypoint: pair
    authentication: []
    apis:
      - name: approve pairing
        method: POST
        title: Approve the destination node pair request
        path: "/approve"
        parameters:
          get:
            - name: requestID
              type: uint64
              required: true
              title: Pair requestID

      - name: complete pairing
        method: POST
        title: Complete pairing with the origin
        path: "/complete"
        parameters:
          post:
            - name: token
              type: string
              required: true
              title: Auth token of the origin node

  - title: Manage structure
    description: Manage structure
    entrypoint: manageStructure
    path: "/nodes/{nodeID}"
    authentication: []
    apis:
      - name: readExposed
        method: GET
        title: Exposed settings for module
        path: "/modules/{moduleID}/exposed"
        parameters:
          path:
            - type: uint64
              name: nodeID
              required: true
              title: Node ID
            - type: uint64
              name: moduleID
              required: true
              title: Module ID
      - name: createExposed
        method: PUT
        title: Add module to federation
        path: "/modules"
        parameters:
          path:
            - type: uint64
              name: nodeID
              required: true
              title: Node ID
          post:
            - type: uint64
              name: composeModuleID
              required: true
              title: Compose module id
            - type: types.ModuleFieldList
              name: fields
              required: false
              title: Exposed module fields
      - name: removeExposed
        method: DELETE
        title: Remove from federation
        path: "/modules/{moduleID}/exposed"
        parameters:
          path:
            - type: uint64
              name: nodeID
              required: true
              title: Node ID
            - type: uint64
              name: moduleID
              required: true
              title: Module ID
      - name: readShared
        method: GET
        title: Shared settings for module
        path: "/modules/{moduleID}/shared"
        parameters:
          path:
            - type: uint64
              name: nodeID
              required: true
              title: Node ID
            - type: uint64
              name: moduleID
              required: true
              title: Module ID
      - name: createMappings
        method: PUT
        title: Add fields mappings to federated module
        path: "/modules/{moduleID}/mapped"
        parameters:
          path:
            - type: uint64
              name: nodeID
              required: true
              title: Node ID
            - type: uint64
              name: moduleID
              required: true
              title: Module ID
          post:
            - type: uint64
              name: composeModuleID
              required: true
              title: Compose module id
            - type: types.ModuleFieldMappingList
              name: fields
              required: false
              title: Exposed module fields
      - name: readMappings
        method: GET
        title: Fields mappings for module
        path: "/modules/{moduleID}/mapped"
        parameters:
          path:
            - type: uint64
              name: nodeID
              required: true
              title: Node ID
            - type: uint64
              name: moduleID
              required: true
              title: Module ID
      - name: listAll
        method: GET
        title: List of shared/exposed modules
        path: "/modules"
        parameters:
          path:
            - type: uint64
              name: nodeID
              required: true
              title: Node ID
          get:
            - name: shared
              type: bool
              required: false
              title: List shared modules
            - name: exposed
              type: bool
              required: false
              title: List exposed modules
